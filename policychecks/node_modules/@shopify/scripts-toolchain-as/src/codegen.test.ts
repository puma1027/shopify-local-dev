import * as path from 'path';
import * as process from 'process';
import * as childProcess from 'child_process';

describe('codegen', () => {
  test.each(['ep1', 'ep2', 'ep3', 'ep4'])('is stable', async (ep) => {
    // This test will fork the current process and run the codegen as a seperate command.
    // If there's any changes that are not commited, the serializers generated are out of
    // date and will need to be updated.
    const opts = {
      cwd: path.join(process.cwd(), 'examples/guest-serialization'),
    };
    childProcess.execSync(`bin/codegen ${ep}`, opts);

    if (process.env.CI) {
      childProcess.execSync(`git diff --exit-code`);
    }
  });
});
