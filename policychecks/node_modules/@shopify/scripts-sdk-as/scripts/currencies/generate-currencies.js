#!/usr/bin/env node
const currencies = require("./currencies.json");
const path = require("path");
const fs = require("fs");

const TAB = "  ";

const OUTPUT_PATH = path.resolve(
  path.join(
    __dirname,
    "..",
    "..",
    "assembly",
    "Money",
    "Currency",
    "Currencies.ts"
  )
);

const ACCESSORS = currencies.map(
  (currency) =>
    `${TAB}static ${currency.code}: Currency = new Currency("${currency.code}", ${currency.subunitsPerUnit});`
);

const FROM_CODE_CONDITIONALS = currencies.map((currency, i) => {
  const conditional = i === 0 ? "if" : "else if";
  return `${TAB}${TAB}${conditional} (code == "${currency.code}") return Currencies.${currency.code};`;
});

const OUTPUT = `// DO NOT MODIFY THIS FILE. This file was generated by "npm run build:currencies"

import { Currency } from "./Currency";

export class Currencies {
${ACCESSORS.join("\n")}

  static fromCode(code: string): Currency {
${FROM_CODE_CONDITIONALS.join("\n")}

    throw new Error(code + " is not a known currency.");
  }
}
`;

fs.writeFileSync(OUTPUT_PATH, OUTPUT);
